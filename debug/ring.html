<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>line</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/maptalks/dist/maptalks.css">
  <!-- 需要用 maptalks worker 分支下的版本 -->
  <script src="js/maptalks.js"></script>
  <script src="js/maptalksgl.js"></script>
  <script src="../dist/maptalks.glowring-dev.js"></script>
  <style>
    html,body{
        margin:0px;
        height:100%;
        width: 100%;
    }
    #map { width: 100%; height: 100%; background-color : #000;}
  </style>
</head>
<body>
<div id="map"></div>
  <script>
    var map = new maptalks.Map("map",{
    center : [13.416935229170008, 52.529564137540376],
    zoom   :  15,
    pitch : 70,
    bearing : 180,

    centerCross : true,
    doubleClickZoom : false,
    attribution : {
      'content' : '<span style="padding:4px;">&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attributions">CARTO</a> &copy; <a href="https://osmbuilding.org">osmbuilding.org</a></span>'
    },
    baseLayer : new maptalks.TileLayer('tile',{
        'urlTemplate' : 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png',
        'subdomains'  : ['a','b','c','d']
    })
});
var vert = `
const float PI = 3.14159265359;

float random(float p){
  	return fract(sin(p) * 10000.0);
} 
  
float noise(vec2 p){
	float t = iTime / 2000.0;
    if(t > 1.0) t -= floor(t);
    return random(p.x * 14. + p.y * sin(t) * 0.5);
}

vec2 sw(vec2 p){
  	return vec2(floor(p.x), floor(p.y));
}
  
vec2 se(vec2 p){
  	return vec2(ceil(p.x), floor(p.y));
}
  
vec2 nw(vec2 p){
  	return vec2(floor(p.x), ceil(p.y));
}
  
vec2 ne(vec2 p){
  	return vec2(ceil(p.x), ceil(p.y));
}

float smoothNoise(vec2 p){
  	vec2 inter = smoothstep(0.0, 1.0, fract(p));
  	float s = mix(noise(sw(p)), noise(se(p)), inter.x);
  	float n = mix(noise(nw(p)), noise(ne(p)), inter.x);
    return mix(s, n, inter.y);
}

mat2 rotate (in float theta){
  	float c = cos(theta);
  	float s = sin(theta);
    return mat2(c, -s, s, c);
}

float circ(vec2 p){
	float r = length(p);
	r = log(sqrt(r));
	return abs(mod(4.0 * r, PI * 2.0) - PI) * 3.0 + 0.2;
}

float fbm(in vec2 p){
	float z = 2.0;
    float rz = 0.0;
    vec2 bp = p;
    for(float i = 1.0; i < 6.0; i++){
    	rz += abs((smoothNoise(p) - 0.5)* 2.0) / z;
        z *= 2.0;
        p *= 2.0;
    }
    return rz;
}

void mainImage( out vec4 fragColor, in vec2 fragCoord )
{
    vec2 p = fragCoord.xy / iResolution.xy - 0.5;
    p.x *= iResolution.x / iResolution.y;
    p *= 4.0;
    float rz = fbm(p);
    p /= exp(mod(iTime * 2.0, PI));
    rz *= pow(abs(0.1 - circ(p)), 0.9);
    vec3 col = vec3(0.2, 0.1, 0.643);
  	fragColor = vec4(col, 1.0) / rz; 
}
`;
 var glowringLayer = new maptalks.GlowRingLayer('glowring').addTo(map);
 var ring = new maptalks.GlowRing(map.getCenter()).addTo(glowringLayer);

  </script>
</body>

</html>
